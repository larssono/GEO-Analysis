#! /usr/bin/env python

#PROJECT_NAME=$1
#FOLDER_NAME=$2
#ENTITY_PATH=$3
#ENTITY_DESCRIPTION=$4
#ACTIVITY_NAME=$5
#ACTIVITY_DESCRIPTION=$6
#PROGRAM_NAME=$7
#PROGRAM_VER=$8
#P1=$9
#P2=$10
#P3=$11
#P4=$12
#P5=$13
#P6=$14

import synapseclient as syn

############# Load input parameters
NUM_PARAMS=8

PROJECT_NAME, FOLDER_NAME, ENTITY_PATH, ENTITY_DESCRIPTION, ACTIVITY_NAME, ACTIVITY_DESCRIPTION, PROGRAM_NAME, PROGRAM_VER = *sys.args[:NUM_PARAMS]
USES_LIST = sys.args[NUM_PARAMS:]

############# Utility functions

def convert_names_to_entities(lst,project_id):
    return map(lambda x: syn.get(x,limitSearch=project_id),lst)

def project_store(project_name):
    project=Project(project_name)
    project_store=syn.store(project)
    return project_store
    
def make_folder_store(project_store, folder_name):
    folder = Folder(folder_name,project_store)
    folder_store =syn.store(folder)
    return folder_store

############# Main

def main():
    project_store = make_project_store(PROJECT_NAME)
    folder_store  = make_folder_store(project_store,FOLDER_NAME)
    entity_store  = make_entity_store(folder_store,ENTITY_PATH,ENTITY_DESCRIPTION)
    uses          = convert_names_to_entities(USES_LIST)
    
    activity = Activity(ACTIVITY_NAME,
                        ACTIVITY_DESCRIPTION,
                        uses,
                        PROGRAM_NAME,
                        PROGRAM_VER)
    syn.setProvenance(entity_store, activity)

############# Run the code

main()